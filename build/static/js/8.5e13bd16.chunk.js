webpackJsonp([8],{333:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function e(e,t){var r=[],a=!0,s=!1,i=void 0;try{for(var n,o=e[Symbol.iterator]();!(a=(n=o.next()).done)&&(r.push(n.value),!t||r.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(s)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_react=__webpack_require__(1),_react2=_interopRequireDefault(_react),_family=__webpack_require__(5),_utils=__webpack_require__(6),_constant=__webpack_require__(18);__webpack_require__(445);var Tester=function(_Component){function Tester(props){_classCallCheck(this,Tester);var _this=_possibleConstructorReturn(this,(Tester.__proto__||Object.getPrototypeOf(Tester)).call(this,props));return _this.switchMod=function(e){},_this.switchItf=function(e){var t=e.properties.map(function(e){return Object.assign({},e)}).filter(function(e){return"request"===e.scope}),r=_utils.Tree.treeToJson(_utils.Tree.arrayToTree(t)),a=_family.Mock.mock(r);_this.setState({requestData:a},function(){_this.handleRequest(e)})},_this.handleRequest=function(itf){var requests=[fetch(_constant.serve+"/app/mock/template/"+itf.id).then(function(e){return e.json()}),fetch(_constant.serve+"/app/mock/schema/"+itf.id).then(function(e){return e.json()})],requestData=_this.state.requestData,uri=(0,_family.URI)(_constant.serve+"/app/mock/data/"+itf.id);for(var key in requestData)""===requestData[key]?uri.removeSearch(key):uri.setSearch(key,requestData[key]);requests.push(fetch(uri).then(function(e){return e.json()}));var repositoryId=itf.repositoryId,method=itf.method,url=itf.url,target=_this.state.target+"/app/mock/"+repositoryId+"/"+method+"/"+url,proxy=_constant.serve+"/proxy?target="+target;requests.push(fetch(proxy).then(function(e){return e.json()})),Promise.all(requests).then(function(_ref){var _ref2=_slicedToArray(_ref,4),template=_ref2[0],schema=_ref2[1],data=_ref2[2],target=_ref2[3];_this.setState({template:template,schema:schema,data:data});var _Mock$valid=_family.Mock.valid,Diff=_Mock$valid.Diff,Assert=_Mock$valid.Assert,nextMatch=Assert.match;Assert.match=function(type,path,actual,expected,result,message){"string"==typeof expected&&(expected=eval("("+expected+")")),nextMatch(type,path,actual,expected,result,message)};for(var result=Diff.diff(schema,target),i=0;i<result.length;i++)console.warn(Assert.message(result[i]))})},_this.updateRequestData=function(e,t,r){_this.setState({requestData:Object.assign({},_this.state.requestData,_defineProperty({},t,r))})},_this.state={requestData:{},template:null,schema:null,data:null,target:_constant.serve},_this}return _inherits(Tester,_Component),_createClass(Tester,[{key:"render",value:function(){var e=this,t=this.context.store,r=this.props,a=r.location.params,s=r.repository;if(!s.fetching&&!s.data)return _react2.default.createElement("div",{className:"p100 fontsize-40 text-center"},"404");if(s=s.data,!s.id)return _react2.default.createElement(_utils.Spin,null);var i=s&&s.modules&&s.modules.length?s.modules.find(function(e){return e.id===+a.mod})||s.modules[0]:{},n=i.interfaces&&i.interfaces.length?i.interfaces.find(function(e){return e.id===+a.itf})||i.interfaces[0]:{},o=this.state.requestData,c=(0,_family.URI)(_constant.serve+"/app/mock/data/"+n.id);for(var l in o)""===o[l]?c.removeSearch(l):c.setSearch(l,o[l]);var u=(0,_family.StoreStateRouterLocationURI)(t).removeSearch("itf");return _react2.default.createElement("section",{className:"Tester"},_react2.default.createElement("div",{className:"header"},_react2.default.createElement("div",{className:"card-mods clearfix"},_react2.default.createElement("div",{className:"card-title"},"模块："),_react2.default.createElement("ul",{className:"clearfix"},s.modules.map(function(e){return _react2.default.createElement("li",{key:e.id,className:e.id===i.id?"active":""},_react2.default.createElement(_family.Link,{to:u.setSearch("mod",e.id).href()},e.name))}))),_react2.default.createElement("div",{className:"card-itfs clearfix"},_react2.default.createElement("div",{className:"card-title"},"接口："),_react2.default.createElement("ul",{className:"clearfix"},i.interfaces.map(function(t){return _react2.default.createElement("li",{key:t.id,className:t.id===n.id?"active":""},_react2.default.createElement(_family.Link,{to:u.setSearch("mod",i.id).setSearch("itf",t.id).href(),onClick:function(r){return e.switchItf(t)}},t.name))})))),_react2.default.createElement("div",{className:"body"},_react2.default.createElement("div",{className:"card-props clearfix"},_react2.default.createElement("form",{onSubmit:function(t){t.preventDefault(),e.handleRequest(n)}},_react2.default.createElement("div",{className:"mb6 ml6 font-bold"},"业务系统："),_react2.default.createElement("input",{value:this.state.target,onChange:function(t){return e.setState({target:t.target.value})},className:"form-control"}),_react2.default.createElement("ul",{className:"fields clearfix"},Object.keys(o).map(function(t){return _react2.default.createElement("li",{key:t,className:"filed"},_react2.default.createElement("div",{className:"label"},t),_react2.default.createElement("input",{value:o[t],onChange:function(r){return e.updateRequestData(r,t,r.target.value)},className:"form-control"}))})),_react2.default.createElement("button",{className:"btn btn-success",type:"submit"},"Submit"))),_react2.default.createElement("div",{className:"card-result"},_react2.default.createElement("div",{className:"card-title"},_react2.default.createElement(_family.Link,{to:c.href(),target:"_blank"},decodeURI(c.href()))),_react2.default.createElement("div",null,_react2.default.createElement("pre",null,JSON.stringify(this.state.data,null,2))))))}},{key:"componentWillReceiveProps",value:function(e){}}]),Tester}(_react.Component);Tester.contextTypes={store:_family.PropTypes.object.isRequired},Tester.propTypes={repository:_family.PropTypes.object.isRequired,location:_family.PropTypes.object.isRequired};var mapStateToProps=function(e){return{repository:e.repository}},mapDispatchToProps={};exports.default=(0,_family.connect)(mapStateToProps,mapDispatchToProps)(Tester)},424:function(e,t,r){t=e.exports=r(22)(),t.push([e.id,".Tester .header{padding:2rem 2rem 1rem;border-bottom:1px solid #e1e4e8;background-color:#fafbfc}.Tester .header .card-itfs,.Tester .header .card-mods{display:-webkit-box;display:-ms-flexbox;display:flex;margin-bottom:1rem}.Tester .header .card-itfs>.card-title,.Tester .header .card-mods>.card-title{margin-bottom:0;width:5rem;min-width:5rem;font-size:1.4rem}.Tester .header .card-itfs>ul,.Tester .header .card-mods>ul{margin-bottom:0;padding-left:0;list-style:none}.Tester .header .card-itfs>ul>li,.Tester .header .card-mods>ul>li{float:left;margin-right:1rem;padding:2px 0;width:10rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.Tester .header .card-itfs>ul>li a,.Tester .header .card-mods>ul>li a{color:#666}.Tester .header .card-itfs>ul>li.active a,.Tester .header .card-mods>ul>li.active a{color:#4a7bf7}.Tester .body{padding:2rem}.Tester .body .card-props{margin-bottom:2rem}.Tester .body .card-props ul.fields{list-style:none;padding-left:0}.Tester .body .card-props ul.fields>li.filed{float:left;margin-right:1rem;width:10rem}.Tester .body .card-props ul.fields>li.filed .label{margin-bottom:.5rem;padding-left:.5rem;font-weight:700}.Tester .body .card-result{margin-top:1rem}.Tester .body .card-result .card-title{font-size:1.2rem;margin-bottom:1rem}",""])},445:function(e,t,r){var a=r(424);"string"==typeof a&&(a=[[e.id,a,""]]);r(24)(a,{});a.locals&&(e.exports=a.locals)}});
//# sourceMappingURL=8.5e13bd16.chunk.js.map